{"ast":null,"code":"var _jsxFileName = \"/Users/coltonjohnson/Desktop/CS490/Plaza/react-starter-main/src/Canvas.js\",\n    _s = $RefreshSig$();\n\n// Canvas that will display current pixel data.\nimport \"./Canvas.css\";\nimport React from 'react';\nimport { useState, useRef, useEffect } from \"react\";\nimport io from \"socket.io-client\";\nimport { socket } from \"./App.js\";\nimport loading_circle from './graphics/loading_circle.gif';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport function Canvas(props) {\n  _s();\n\n  var Renderer; // STATES\n\n  const [mode, setMode] = useState(0); // current mode of canvas:\n  //  0 - Obtaining canvas data...\n  //  1 - Timeout obtaining canvas data...\n  //  2 - Success loading\n\n  const [enabled, setEnabled] = useState(false); // set this to True to be able to click on canvas\n\n  const [data, setData] = useState([]); // contains pixel data\n\n  const [canvasSize, setCanvasSize] = useState(0); // contains width (width=height) of canvas displayed pixels\n  // NOTE: This is different from HTML canvas size\n\n  var canvas_ref = /*#__PURE__*/React.createRef(); // receive socketio canvas_state\n\n  useEffect(() => {\n    socket.on(\"canvas_state\", data => {\n      if (mode == 0) {\n        alert(\"RECIEVED DATA FROM SERVER\");\n        setData(data.data);\n        setMode(2);\n      }\n    });\n  }, []); // convert color index to rgb\n\n  function toColor(x) {\n    if (x == 0) {\n      return [255, 0, 0];\n    } else if (x == 1) {\n      return [255, 69, 0];\n    } else if (x == 2) {\n      return [255, 165, 0];\n    } else if (x == 3) {\n      return [255, 174, 66];\n    } else if (x == 4) {\n      return [255, 255, 0];\n    } else if (x == 5) {\n      return [154, 205, 50];\n    } else if (x == 6) {\n      return [0, 255, 0];\n    } else if (x == 7) {\n      return [13, 152, 186];\n    } else if (x == 8) {\n      return [0, 0, 255];\n    } else if (x == 9) {\n      return [138, 43, 226];\n    } else if (x == 10) {\n      return [238, 130, 238];\n    } else if (x == 11) {\n      return [199, 21, 133];\n    } else if (x == 12) {\n      return [255, 255, 255];\n    } else if (x == 13) {\n      return [0, 0, 0];\n    } else {\n      return [0, 0, 0]; // index out of bounds\n    }\n  } // uses 'data' state to create pixels\n\n\n  function redraw() {\n    var context = canvas_ref.current.getContext('2d');\n    var i = 0;\n    var canvas_width = canvas_ref.current.width;\n    var canvas_height = canvas_ref.current.height;\n    var pixel_width = canvas_height / canvasSize;\n    var pixel_height = canvas_height / canvasSize;\n    var p1 = context.transformedPoint(0, 0);\n    var p2 = context.transformedPoint(canvas_width, canvas_height);\n    context.clearRect(p1.x, p1.y, p2.x - p1.x, p2.y - p1.y);\n\n    for (var x = 0; x < canvasSize; x++) {\n      for (var y = 0; y < canvasSize; y++) {\n        var color = toColor(data[i]);\n        i += 1;\n        context.fillStyle = \"rgb(\" + color[0] + \",\" + color[1] + \",\" + color[2] + \")\";\n        context.fillRect(x * pixel_width + x, y * pixel_height + y, pixel_width, pixel_height);\n      }\n    }\n  } // When canvas is loaded\n\n\n  useEffect(() => {\n    if (mode == 2) {\n      // IMPLEMENT CANVAS PANNING/ZOOMING     http://phrogz.net/tmp/canvas_zoom_to_cursor.html\n      var canvas = canvas_ref.current;\n      var ctx = canvas.getContext('2d');\n      trackTransforms(ctx);\n      ctx.translate(canvas.width / 4, 0);\n      redraw();\n      var lastX = canvas.width / 2,\n          lastY = canvas.height / 2;\n      var dragStart, dragged;\n      canvas.addEventListener('mousedown', function (evt) {\n        document.body.style.mozUserSelect = document.body.style.webkitUserSelect = document.body.style.userSelect = 'none';\n        lastX = evt.offsetX || evt.pageX - canvas.offsetLeft;\n        lastY = evt.offsetY || evt.pageY - canvas.offsetTop;\n        dragStart = ctx.transformedPoint(lastX, lastY);\n        dragged = false;\n      }, false);\n      canvas.addEventListener('mousemove', function (evt) {\n        lastX = evt.offsetX || evt.pageX - canvas.offsetLeft;\n        lastY = evt.offsetY || evt.pageY - canvas.offsetTop;\n        dragged = true;\n\n        if (dragStart) {\n          var pt = ctx.transformedPoint(lastX, lastY);\n          ctx.translate(pt.x - dragStart.x, pt.y - dragStart.y);\n          redraw();\n        }\n      }, false);\n      canvas.addEventListener('mouseup', function (evt) {\n        dragStart = null;\n        if (!dragged) zoom(evt.shiftKey ? -1 : 1);\n      }, false);\n      var scaleFactor = 1.05;\n\n      var zoom = function (clicks) {\n        var pt = ctx.transformedPoint(lastX, lastY);\n        ctx.translate(pt.x, pt.y);\n        var factor = Math.pow(scaleFactor, clicks);\n        ctx.scale(factor, factor);\n        ctx.translate(-pt.x, -pt.y);\n        redraw();\n      };\n\n      var handleScroll = function (evt) {\n        var delta = evt.wheelDelta ? evt.wheelDelta / 40 : evt.detail ? -evt.detail : 0;\n        if (delta) zoom(delta);\n        return evt.preventDefault() && false;\n      };\n\n      canvas.addEventListener('DOMMouseScroll', handleScroll, false);\n      canvas.addEventListener('mousewheel', handleScroll, false);\n    }\n  }, [canvasSize]); // testing function\n\n  function test() {\n    const TESTING_SIZE = 50;\n    setCanvasSize(TESTING_SIZE);\n    var a = new Uint8ClampedArray(TESTING_SIZE * TESTING_SIZE);\n\n    for (var x = 0; x < TESTING_SIZE * TESTING_SIZE; x++) {\n      a[x] = Math.random() * (13 - 0 + 1) << 0; // generate random int between 0 & 13\n    }\n\n    setData(a);\n    setMode(2);\n  }\n\n  if (mode == 0) {\n    // CANVAS INFO NOT YET LOADED\n    window.addEventListener('load', () => {\n      // OBTAINING CANVAS DATA FROM SERVER\n      socket.emit(\"canvas_request\", {});\n      setTimeout(() => {\n        setMode(1);\n      }, 2000);\n    });\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"canvas\",\n      className: \"canvas_placeholder\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"img\", {\n          src: loading_circle\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 13\n    }, this);\n  } else if (mode == 1) {\n    // TIMEOUT OBTAINING CANVAS DATA FROM SERVER\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"canvas\",\n      className: \"canvas_placeholder\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            padding: 40\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Unable to Load Canvas :(\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 187,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: /*#__PURE__*/_jsxDEV(\"i\", {\n              children: \"We were unable to get canvas data from our servers. Try reloading the page or trying again later.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 188,\n              columnNumber: 28\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 188,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n            onClick: test,\n            children: \"Continue anyway\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 189,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 13\n    }, this);\n  } else if (mode == 2) {\n    // SUCESSFULLY LOADED CANVAS DATA FROM SERVER\n    function onCanvasClick() {// TODO: implement something here...\n    }\n\n    return /*#__PURE__*/_jsxDEV(\"canvas\", {\n      width: \"1200\",\n      height: \"600\",\n      id: \"canvas\",\n      onClick: onCanvasClick,\n      ref: canvas_ref\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 13\n    }, this);\n  } // Adds ctx.getTransform() - returns an SVGMatrix\n  // Adds ctx.transformedPoint(x,y) - returns an SVGPoint\n\n\n  function trackTransforms(ctx) {\n    var svg = document.createElementNS(\"http://www.w3.org/2000/svg\", 'svg');\n    var xform = svg.createSVGMatrix();\n\n    ctx.getTransform = function () {\n      return xform;\n    };\n\n    var savedTransforms = [];\n    var save = ctx.save;\n\n    ctx.save = function () {\n      savedTransforms.push(xform.translate(0, 0));\n      return save.call(ctx);\n    };\n\n    var restore = ctx.restore;\n\n    ctx.restore = function () {\n      xform = savedTransforms.pop();\n      return restore.call(ctx);\n    };\n\n    var scale = ctx.scale;\n\n    ctx.scale = function (sx, sy) {\n      xform = xform.scaleNonUniform(sx, sy);\n      return scale.call(ctx, sx, sy);\n    };\n\n    var rotate = ctx.rotate;\n\n    ctx.rotate = function (radians) {\n      xform = xform.rotate(radians * 180 / Math.PI);\n      return rotate.call(ctx, radians);\n    };\n\n    var translate = ctx.translate;\n\n    ctx.translate = function (dx, dy) {\n      xform = xform.translate(dx, dy);\n      return translate.call(ctx, dx, dy);\n    };\n\n    var transform = ctx.transform;\n\n    ctx.transform = function (a, b, c, d, e, f) {\n      var m2 = svg.createSVGMatrix();\n      m2.a = a;\n      m2.b = b;\n      m2.c = c;\n      m2.d = d;\n      m2.e = e;\n      m2.f = f;\n      xform = xform.multiply(m2);\n      return transform.call(ctx, a, b, c, d, e, f);\n    };\n\n    var setTransform = ctx.setTransform;\n\n    ctx.setTransform = function (a, b, c, d, e, f) {\n      xform.a = a;\n      xform.b = b;\n      xform.c = c;\n      xform.d = d;\n      xform.e = e;\n      xform.f = f;\n      return setTransform.call(ctx, a, b, c, d, e, f);\n    };\n\n    var pt = svg.createSVGPoint();\n\n    ctx.transformedPoint = function (x, y) {\n      pt.x = x;\n      pt.y = y;\n      return pt.matrixTransform(xform.inverse());\n    };\n  }\n}\n\n_s(Canvas, \"a98//AzzxnZRRKzDldX68VWr/6w=\");\n\n_c = Canvas;\n\nvar _c;\n\n$RefreshReg$(_c, \"Canvas\");","map":{"version":3,"sources":["/Users/coltonjohnson/Desktop/CS490/Plaza/react-starter-main/src/Canvas.js"],"names":["React","useState","useRef","useEffect","io","socket","loading_circle","Canvas","props","Renderer","mode","setMode","enabled","setEnabled","data","setData","canvasSize","setCanvasSize","canvas_ref","createRef","on","alert","toColor","x","redraw","context","current","getContext","i","canvas_width","width","canvas_height","height","pixel_width","pixel_height","p1","transformedPoint","p2","clearRect","y","color","fillStyle","fillRect","canvas","ctx","trackTransforms","translate","lastX","lastY","dragStart","dragged","addEventListener","evt","document","body","style","mozUserSelect","webkitUserSelect","userSelect","offsetX","pageX","offsetLeft","offsetY","pageY","offsetTop","pt","zoom","shiftKey","scaleFactor","clicks","factor","Math","pow","scale","handleScroll","delta","wheelDelta","detail","preventDefault","test","TESTING_SIZE","a","Uint8ClampedArray","random","window","emit","setTimeout","padding","onCanvasClick","svg","createElementNS","xform","createSVGMatrix","getTransform","savedTransforms","save","push","call","restore","pop","sx","sy","scaleNonUniform","rotate","radians","PI","dx","dy","transform","b","c","d","e","f","m2","multiply","setTransform","createSVGPoint","matrixTransform","inverse"],"mappings":"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","sourcesContent":["// Canvas that will display current pixel data.\nimport \"./Canvas.css\";\nimport React from 'react';\nimport { useState, useRef, useEffect } from \"react\";\nimport io from \"socket.io-client\";\nimport {socket} from \"./App.js\";\nimport loading_circle from './graphics/loading_circle.gif';\n\nexport function Canvas(props) {\n    var Renderer;\n\n    // STATES\n    const [mode, setMode] = useState(0);  // current mode of canvas:\n                                            //  0 - Obtaining canvas data...\n                                            //  1 - Timeout obtaining canvas data...\n                                            //  2 - Success loading\n\n    const [enabled, setEnabled] = useState(false); // set this to True to be able to click on canvas\n    const [data, setData] = useState([]); // contains pixel data\n    const [canvasSize, setCanvasSize] = useState(0);  // contains width (width=height) of canvas displayed pixels\n                                                    // NOTE: This is different from HTML canvas size\n\n    var canvas_ref = React.createRef();\n\n    // receive socketio canvas_state\n    useEffect(() => {\n        socket.on(\"canvas_state\", (data) => {\n            if (mode == 0) {\n                alert(\"RECIEVED DATA FROM SERVER\");\n                setData(data.data);\n                setMode(2);\n            }            \n        });\n    }, []);\n\n    // convert color index to rgb\n    function toColor(x) {\n        if (x == 0) {\n            return [255,0,0];\n        } else if (x == 1) {\n            return [255,69,0];\n        } else if (x == 2) {\n            return [255,165,0];\n        } else if (x == 3) {\n            return [255, 174, 66];\n        } else if (x == 4) {\n            return [255, 255, 0];\n        } else if (x == 5) {\n            return [154, 205, 50];\n        } else if (x == 6) {\n            return [0, 255, 0];\n        } else if (x == 7) {\n            return [13, 152, 186];\n        } else if (x == 8) {\n            return [0,0,255];\n        } else if (x == 9) {\n            return [138, 43, 226];\n        } else if (x == 10) {\n            return [238, 130, 238];\n        } else if (x == 11) {\n            return [199, 21, 133];\n        } else if (x == 12) {\n            return [255,255,255];\n        } else if (x == 13) {\n            return [0,0,0];\n        } else {\n            return [0,0,0]; // index out of bounds\n        }\n    }\n    // uses 'data' state to create pixels\n    function redraw() {\n        var context = canvas_ref.current.getContext('2d');\n        var i = 0;\n        \n        var canvas_width = canvas_ref.current.width;\n        var canvas_height = canvas_ref.current.height;\n\n        var pixel_width = (canvas_height / canvasSize);\n        var pixel_height = (canvas_height / canvasSize);\n\n        var p1 = context.transformedPoint(0,0);\n        var p2 = context.transformedPoint(canvas_width,canvas_height);\n        context.clearRect(p1.x,p1.y,p2.x-p1.x,p2.y-p1.y);\n\n        for(var x=0;x<canvasSize;x++) {\n            for(var y=0;y<canvasSize;y++) {\n                var color = toColor(data[i]);\n                i += 1;\n                context.fillStyle= \"rgb(\"+color[0] + \",\" + color[1] + \",\" + color[2] + \")\";\n                context.fillRect(x*pixel_width+x,y*pixel_height+y,pixel_width,pixel_height);\n            }\n        }    \n    }\n\n    // When canvas is loaded\n    useEffect(()=>{\n        if (mode == 2) {\n            // IMPLEMENT CANVAS PANNING/ZOOMING     http://phrogz.net/tmp/canvas_zoom_to_cursor.html\n            var canvas = canvas_ref.current;\n            var ctx = canvas.getContext('2d');\n            \n\t\t    trackTransforms(ctx);\n            ctx.translate(canvas.width/4,0);\n\n            redraw();\n\t\t\n            var lastX=canvas.width/2, lastY=canvas.height/2;\n            var dragStart,dragged;\n            canvas.addEventListener('mousedown',function(evt){\n                document.body.style.mozUserSelect = document.body.style.webkitUserSelect = document.body.style.userSelect = 'none';\n                lastX = evt.offsetX || (evt.pageX - canvas.offsetLeft);\n                lastY = evt.offsetY || (evt.pageY - canvas.offsetTop);\n                dragStart = ctx.transformedPoint(lastX,lastY);\n                dragged = false;\n            },false);\n            canvas.addEventListener('mousemove',function(evt){\n                lastX = evt.offsetX || (evt.pageX - canvas.offsetLeft);\n                lastY = evt.offsetY || (evt.pageY - canvas.offsetTop);\n                dragged = true;\n                if (dragStart){\n                    var pt = ctx.transformedPoint(lastX,lastY);\n                    ctx.translate(pt.x-dragStart.x,pt.y-dragStart.y);\n                    redraw();\n                }\n            },false);\n            canvas.addEventListener('mouseup',function(evt){\n                dragStart = null;\n                if (!dragged) zoom(evt.shiftKey ? -1 : 1 );\n            },false);\n\n            var scaleFactor = 1.05;\n            var zoom = function(clicks){\n                var pt = ctx.transformedPoint(lastX,lastY);\n                ctx.translate(pt.x,pt.y);\n                var factor = Math.pow(scaleFactor,clicks);\n                ctx.scale(factor,factor);\n                ctx.translate(-pt.x,-pt.y);\n                redraw();\n            }\n\n            var handleScroll = function(evt){\n                var delta = evt.wheelDelta ? evt.wheelDelta/40 : evt.detail ? -evt.detail : 0;\n                if (delta) zoom(delta);\n                return evt.preventDefault() && false;\n            };\n            canvas.addEventListener('DOMMouseScroll',handleScroll,false);\n            canvas.addEventListener('mousewheel',handleScroll,false);\n        }\n    },[canvasSize]);\n\n    // testing function\n    function test() {\n        const TESTING_SIZE = 50;\n\n        setCanvasSize(TESTING_SIZE);\n\n        var a = new Uint8ClampedArray(TESTING_SIZE*TESTING_SIZE)\n        for(var x=0;x<TESTING_SIZE*TESTING_SIZE;x++) {\n            a[x] = (Math.random() * (13 - 0 + 1) ) << 0; // generate random int between 0 & 13\n        }\n\n        setData(a);\n        setMode(2);\n    }\n\n    if (mode == 0) {   // CANVAS INFO NOT YET LOADED\n\n        window.addEventListener('load', () => {                         // OBTAINING CANVAS DATA FROM SERVER\n            socket.emit(\"canvas_request\",{});\n            setTimeout(()=>{\n                setMode(1);\n            },2000);\n        });\n\n        return (\n            <div id=\"canvas\" className=\"canvas_placeholder\">\n                <div>\n                    <img src={loading_circle}/>\n                </div>                \n            </div>\n        );\n    } else if (mode == 1) {                                            // TIMEOUT OBTAINING CANVAS DATA FROM SERVER\n        return (\n            <div id=\"canvas\" className=\"canvas_placeholder\">\n                <div>\n                    <div style={{padding: 40}}>\n                        <h3>Unable to Load Canvas :(</h3>\n                        <p><i>We were unable to get canvas data from our servers. Try reloading the page or trying again later.</i></p>\n                        <a onClick={test}>\n                            Continue anyway\n                        </a>\n                    </div>\n                </div>                \n            </div>\n        );\n    } else if (mode == 2) {                                            // SUCESSFULLY LOADED CANVAS DATA FROM SERVER\n        function onCanvasClick() {\n            // TODO: implement something here...\n        }\n\n        return (\n            <canvas width=\"1200\" height=\"600\"\n            id=\"canvas\" onClick={onCanvasClick} ref={canvas_ref}>\n            </canvas>\n        );\n    }\n\n    // Adds ctx.getTransform() - returns an SVGMatrix\n\t// Adds ctx.transformedPoint(x,y) - returns an SVGPoint\n\tfunction trackTransforms(ctx){\n\t\tvar svg = document.createElementNS(\"http://www.w3.org/2000/svg\",'svg');\n\t\tvar xform = svg.createSVGMatrix();\n\t\tctx.getTransform = function(){ return xform; };\n\t\t\n\t\tvar savedTransforms = [];\n\t\tvar save = ctx.save;\n\t\tctx.save = function(){\n\t\t\tsavedTransforms.push(xform.translate(0,0));\n\t\t\treturn save.call(ctx);\n\t\t};\n\t\tvar restore = ctx.restore;\n\t\tctx.restore = function(){\n\t\t\txform = savedTransforms.pop();\n\t\t\treturn restore.call(ctx);\n\t\t};\n\n\t\tvar scale = ctx.scale;\n\t\tctx.scale = function(sx,sy){\n\t\t\txform = xform.scaleNonUniform(sx,sy);\n\t\t\treturn scale.call(ctx,sx,sy);\n\t\t};\n\t\tvar rotate = ctx.rotate;\n\t\tctx.rotate = function(radians){\n\t\t\txform = xform.rotate(radians*180/Math.PI);\n\t\t\treturn rotate.call(ctx,radians);\n\t\t};\n\t\tvar translate = ctx.translate;\n\t\tctx.translate = function(dx,dy){\n\t\t\txform = xform.translate(dx,dy);\n\t\t\treturn translate.call(ctx,dx,dy);\n\t\t};\n\t\tvar transform = ctx.transform;\n\t\tctx.transform = function(a,b,c,d,e,f){\n\t\t\tvar m2 = svg.createSVGMatrix();\n\t\t\tm2.a=a; m2.b=b; m2.c=c; m2.d=d; m2.e=e; m2.f=f;\n\t\t\txform = xform.multiply(m2);\n\t\t\treturn transform.call(ctx,a,b,c,d,e,f);\n\t\t};\n\t\tvar setTransform = ctx.setTransform;\n\t\tctx.setTransform = function(a,b,c,d,e,f){\n\t\t\txform.a = a;\n\t\t\txform.b = b;\n\t\t\txform.c = c;\n\t\t\txform.d = d;\n\t\t\txform.e = e;\n\t\t\txform.f = f;\n\t\t\treturn setTransform.call(ctx,a,b,c,d,e,f);\n\t\t};\n\t\tvar pt  = svg.createSVGPoint();\n\t\tctx.transformedPoint = function(x,y){\n\t\t\tpt.x=x; pt.y=y;\n\t\t\treturn pt.matrixTransform(xform.inverse());\n\t\t}\n\t}\n}"]},"metadata":{},"sourceType":"module"}